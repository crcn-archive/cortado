// Generated by CoffeeScript 1.6.3
exports.require = ["sock.clients", "tests", "pubsub"];

exports.plugin = function(clients, tests, pubsub) {
  var controls, platform;
  controls = {
    reload: function() {
      return clients.send({
        event: "reload"
      });
    }
  };
  platform = function(event) {
    var p;
    if (!event.client.platform) {
      return "Browser";
    }
    p = event.client.platform;
    return "" + p.name + "@" + (p.version.split('.').shift());
  };
  clients.on("fail", function(event) {
    var p;
    p = platform(event);
    return pubsub.publish("error", {
      message: "" + p + " - " + event.data.message
    });
  });
  clients.on("startTests", function(event) {
    var p;
    p = platform(event);
    return pubsub.publish("notify", {
      type: "info",
      message: "" + p + " - tests start"
    });
  });
  clients.on("endTests", function(event) {
    var p;
    p = platform(event);
    return pubsub.publish("notify", {
      type: "info",
      message: "" + p + " - tests complete"
    });
  });
  tests.on("bundle", controls.reload);
  return controls;
};
