// Generated by CoffeeScript 1.6.3
/*
  waits for browsers, then kills cortado
  after all browsers have completed
*/

exports.require = ["sock.clients", "config"];

exports.plugin = function(clients, config) {
  var hasErrors, keepAlive, killProcess, numRunning;
  keepAlive = config.get("keepAlive");
  numRunning = 0;
  hasErrors = 0;
  killProcess = function() {
    return setTimeout((function() {
      return process.exit(Number(hasErrors));
    }), 100);
  };
  return clients.on("client", function(client) {
    client.on("startTests", function() {
      return numRunning++;
    });
    return client.on("endTests", function(info) {
      hasErrors = hasErrors || info.failureCount > 0;
      if (!--numRunning && !keepAlive) {
        return killProcess();
      }
    });
  });
};
