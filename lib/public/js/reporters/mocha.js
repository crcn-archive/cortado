// Generated by CoffeeScript 1.6.3
var bindable;

bindable = require("bindable");

module.exports = function(models) {
  return function(runner) {
    var current;
    current = void 0;
    runner.on("start", function() {});
    runner.on("test", function(test) {
      return current = models.addLog({
        description: test.title,
        type: "test",
        state: test.state,
        pending: true
      });
    });
    runner.on("fail", function(test, err) {
      return test.error = err;
    });
    return runner.on("test end", function(test) {
      var skipped;
      skipped = test.pending === true;
      current.set({
        time: skipped ? 0 : test.duration,
        pending: false,
        success: test.state === "passed",
        state: test.state
      });
      if (test.error) {
        return models.addLog({
          description: test.error.message,
          type: "error"
        });
      }
    });
  };
};
